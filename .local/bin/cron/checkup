#!/bin/sh

# Syncs repositories and downloads updates, meant to be run as a cronjob.

notify-send " Repository Sync" "Checking for package updates..."

sudo pacman -Syyuw --noconfirm || notify-send "Error downloading updates." "Check your internet connection, if pacman is already running, or run update manually to see errors."
pkill -RTMIN+8 "${STATUSBAR:-dwmblocks}"

if pacman -Qu | grep -v "\[ignored\]"; then
	answer=$(
        notify-send --action=Yes=Yes --action=No=No \
        " Repository Sync" "Updates available. Update now?"
    )
    [ $answer -eq 1 ] && $TERMINAL -e upgrades
else
	notify-send " Repository Sync" "Sync complete. No new packages for update."
fi
